!function(e){function t(e){var t=require("./"+e+"."+o+".hot-update.js");!function(e,t){if(!w[e]||!b[e])return;for(var r in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,r)&&(h[r]=t[r]);0==--y&&0===m&&x()}(t.id,t.modules)}var r,n=!0,o="6528cd6fef958f88c28a",i={},a=[],c=[];function s(e){var t=S[e];if(!t)return A;var n=function(n){return t.hot.active?(S[n]?-1===S[n].parents.indexOf(e)&&S[n].parents.push(e):(a=[e],r=n),-1===t.children.indexOf(n)&&t.children.push(n)):(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),a=[]),A(n)},o=function(e){return{configurable:!0,enumerable:!0,get:function(){return A[e]},set:function(t){A[e]=t}}};for(var i in A)Object.prototype.hasOwnProperty.call(A,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(n,i,o(i));return n.e=function(e){return"ready"===d&&f("prepare"),m++,A.e(e).then(t,(function(e){throw t(),e}));function t(){m--,"prepare"===d&&(v[e]||P(e),0===m&&0===y&&x())}},n.t=function(e,t){return 1&t&&(e=n(e)),A.t(e,-2&t)},n}function u(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:r!==e,active:!0,accept:function(e,r){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._acceptedDependencies[e[n]]=r||function(){};else t._acceptedDependencies[e]=r||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._declinedDependencies[e[r]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var r=t._disposeHandlers.indexOf(e);r>=0&&t._disposeHandlers.splice(r,1)},check:_,apply:O,status:function(e){if(!e)return d;l.push(e)},addStatusHandler:function(e){l.push(e)},removeStatusHandler:function(e){var t=l.indexOf(e);t>=0&&l.splice(t,1)},data:i[e]};return r=void 0,t}var l=[],d="idle";function f(e){d=e;for(var t=0;t<l.length;t++)l[t].call(null,e)}var p,h,g,y=0,m=0,v={},b={},w={};function k(e){return+e+""===e?+e:e}function _(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return n=e,f("check"),function(){try{var e=require("./"+o+".hot-update.json")}catch(e){return Promise.resolve()}return Promise.resolve(e)}().then((function(e){if(!e)return f("idle"),null;b={},v={},w=e.c,g=e.h,f("prepare");var t=new Promise((function(e,t){p={resolve:e,reject:t}}));h={};return P(0),"prepare"===d&&0===m&&0===y&&x(),t}))}function P(e){w[e]?(b[e]=!0,y++,t(e)):v[e]=!0}function x(){f("ready");var e=p;if(p=null,e)if(n)Promise.resolve().then((function(){return O(n)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var r in h)Object.prototype.hasOwnProperty.call(h,r)&&t.push(k(r));e.resolve(t)}}function O(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var r,n,c,s,u;function l(e){for(var t=[e],r={},n=t.map((function(e){return{chain:[e],id:e}}));n.length>0;){var o=n.pop(),i=o.id,a=o.chain;if((s=S[i])&&!s.hot._selfAccepted){if(s.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:i};if(s.hot._main)return{type:"unaccepted",chain:a,moduleId:i};for(var c=0;c<s.parents.length;c++){var u=s.parents[c],l=S[u];if(l){if(l.hot._declinedDependencies[i])return{type:"declined",chain:a.concat([u]),moduleId:i,parentId:u};-1===t.indexOf(u)&&(l.hot._acceptedDependencies[i]?(r[u]||(r[u]=[]),p(r[u],[i])):(delete r[u],t.push(u),n.push({chain:a.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:r}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];-1===e.indexOf(n)&&e.push(n)}}t=t||{};var y={},m=[],v={},b=function(){console.warn("[HMR] unexpected require("+P.moduleId+") to disposed module")};for(var _ in h)if(Object.prototype.hasOwnProperty.call(h,_)){var P;u=k(_);var x=!1,O=!1,E=!1,T="";switch((P=h[_]?l(u):{type:"disposed",moduleId:_}).chain&&(T="\nUpdate propagation: "+P.chain.join(" -> ")),P.type){case"self-declined":t.onDeclined&&t.onDeclined(P),t.ignoreDeclined||(x=new Error("Aborted because of self decline: "+P.moduleId+T));break;case"declined":t.onDeclined&&t.onDeclined(P),t.ignoreDeclined||(x=new Error("Aborted because of declined dependency: "+P.moduleId+" in "+P.parentId+T));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(P),t.ignoreUnaccepted||(x=new Error("Aborted because "+u+" is not accepted"+T));break;case"accepted":t.onAccepted&&t.onAccepted(P),O=!0;break;case"disposed":t.onDisposed&&t.onDisposed(P),E=!0;break;default:throw new Error("Unexception type "+P.type)}if(x)return f("abort"),Promise.reject(x);if(O)for(u in v[u]=h[u],p(m,P.outdatedModules),P.outdatedDependencies)Object.prototype.hasOwnProperty.call(P.outdatedDependencies,u)&&(y[u]||(y[u]=[]),p(y[u],P.outdatedDependencies[u]));E&&(p(m,[P.moduleId]),v[u]=b)}var N,j=[];for(n=0;n<m.length;n++)u=m[n],S[u]&&S[u].hot._selfAccepted&&v[u]!==b&&j.push({module:u,errorHandler:S[u].hot._selfAccepted});f("dispose"),Object.keys(w).forEach((function(e){!1===w[e]&&function(e){delete installedChunks[e]}(e)}));for(var C,H,D=m.slice();D.length>0;)if(u=D.pop(),s=S[u]){var I={},B=s.hot._disposeHandlers;for(c=0;c<B.length;c++)(r=B[c])(I);for(i[u]=I,s.hot.active=!1,delete S[u],delete y[u],c=0;c<s.children.length;c++){var K=S[s.children[c]];K&&((N=K.parents.indexOf(u))>=0&&K.parents.splice(N,1))}}for(u in y)if(Object.prototype.hasOwnProperty.call(y,u)&&(s=S[u]))for(H=y[u],c=0;c<H.length;c++)C=H[c],(N=s.children.indexOf(C))>=0&&s.children.splice(N,1);for(u in f("apply"),o=g,v)Object.prototype.hasOwnProperty.call(v,u)&&(e[u]=v[u]);var M=null;for(u in y)if(Object.prototype.hasOwnProperty.call(y,u)&&(s=S[u])){H=y[u];var q=[];for(n=0;n<H.length;n++)if(C=H[n],r=s.hot._acceptedDependencies[C]){if(-1!==q.indexOf(r))continue;q.push(r)}for(n=0;n<q.length;n++){r=q[n];try{r(H)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:H[n],error:e}),t.ignoreErrored||M||(M=e)}}}for(n=0;n<j.length;n++){var R=j[n];u=R.module,a=[u];try{A(u)}catch(e){if("function"==typeof R.errorHandler)try{R.errorHandler(e)}catch(r){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:r,originalError:e}),t.ignoreErrored||M||(M=r),M||(M=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:e}),t.ignoreErrored||M||(M=e)}}return M?(f("fail"),Promise.reject(M)):(f("idle"),new Promise((function(e){e(m)})))}var S={};function A(t){if(S[t])return S[t].exports;var r=S[t]={i:t,l:!1,exports:{},hot:u(t),parents:(c=a,a=[],c),children:[]};return e[t].call(r.exports,r,r.exports,s(t)),r.l=!0,r.exports}A.m=e,A.c=S,A.d=function(e,t,r){A.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},A.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},A.t=function(e,t){if(1&t&&(e=A(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(A.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)A.d(r,n,function(t){return e[t]}.bind(null,n));return r},A.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return A.d(t,"a",t),t},A.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},A.p="",A.h=function(){return o},s(16)(A.s=16)}([function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("bip39")},function(e,t){e.exports=require("bitcoinjs-lib")},function(e,t){e.exports=require("hash-handler")},function(e,t){e.exports=require("tslib")},function(e,t){e.exports=require("blockstack")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("jsontokens")},function(e,t){e.exports=require("localstorage-polyfill")},function(e,t){e.exports=require("ecurve")},function(e,t){var r="info";function n(){}function o(e){return"info"===r&&"info"===e||["info","warning"].indexOf(r)>=0&&"warning"===e||["info","warning","error"].indexOf(r)>=0&&"error"===e}function i(e){return function(t,r){o(t)&&e(r)}}e.exports=function(e,t){o(e)&&("info"===e?console.log(t):"warning"===e?console.warn(t):"error"===e&&console.error(t))};var a=console.group||n,c=console.groupCollapsed||n,s=console.groupEnd||n;e.exports.group=i(a),e.exports.groupCollapsed=i(c),e.exports.groupEnd=i(s),e.exports.setLogLevel=function(e){r=e},e.exports.formatError=function(e){var t=e.message,r=e.stack;return r?r.indexOf(t)<0?t+"\n"+r:r:t}},function(e,t){e.exports=require("@awaitjs/express")},function(e,t){e.exports=require("radiks")},function(e,t){e.exports=require("radiks-server/app/lib/constants")},function(e,t){e.exports=require("triplesec")},function(e,t){e.exports=require("zone-file")},function(e,t,r){r(17),e.exports=r(19)},function(e,t,r){(function(t){var n=+t.substr(1)||6e5,o=r(10);setInterval((function t(n){"idle"===e.hot.status()&&e.hot.check(!0).then((function(e){e?(r(18)(e,e),t(!0)):n&&o("info","[HMR] Update applied.")})).catch((function(t){var r=e.hot.status();["abort","fail"].indexOf(r)>=0?(o("warning","[HMR] Cannot apply update."),o("warning","[HMR] "+o.formatError(t)),o("warning","[HMR] You need to restart the application!")):o("warning","[HMR] Update failed: "+o.formatError(t))}))}),n)}).call(this,"?100")},function(e,t,r){e.exports=function(e,t){var n=e.filter((function(e){return t&&t.indexOf(e)<0})),o=r(10);(n.length>0&&(o("warning","[HMR] The following modules couldn't be hot updated: (They would need a full reload!)"),n.forEach((function(e){o("warning","[HMR]  - "+e)}))),t&&0!==t.length)?(o("info","[HMR] Updated modules:"),t.forEach((function(e){if("string"==typeof e&&-1!==e.indexOf("!")){var t=e.split("!");o.groupCollapsed("info","[HMR]  - "+t.pop()),o("info","[HMR]  - "+e),o.groupEnd("info")}else o("info","[HMR]  - "+e)})),t.every((function(e){return"number"==typeof e}))&&o("info","[HMR] Consider using the NamedModulesPlugin for module names.")):o("info","[HMR] Nothing hot updated.")}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);r(20),r(8);const o=new(r(23));r(8);r(24);global.window=o,global.document=o.document;const i=n.__importDefault(r(25)),a=n.__importDefault(r(6)),c=n.__importDefault(r(26)),s=n.__importDefault(r(27)),u=n.__importDefault(r(28)),l=r(29),d=r(30),f=r(31),p=r(32),h=(r(35),r(36)),g=r(37),{STREAM_CRAWL_EVENT:y}=r(13),m=a.default();m.use(c.default("dev")),m.use(a.default.json()),m.use(a.default.urlencoded({extended:!0})),m.use(i.default()),m.use("/api",u.default);const v=s.default.join(e,"views");m.set("views",v);const b=s.default.join(e,"public");m.use(a.default.static(b)),m.get("/",(e,t)=>t.status(d.OK).json({hi:"the-local-server"})),m.get("/manifest.json",(t,r)=>{r.header("Access-Control-Allow-Origin","*"),r.header("Access-Control-Allow-Headers","*"),r.sendFile(s.default.join(e,"..","static","manifest.json"))});const w=Number(process.env.PORT||5e3),k=m.listen(w,()=>{console.log("Express server started on port: "+w)});l.setup().then(e=>n.__awaiter(void 0,void 0,void 0,(function*(){const t=r(38)(k);m.use("/radiks",e),m.use("/api",g(e.DB)),m.use("/placeinfo",f.PlaceInfoController(e.DB));let n=yield p.createKeyChain(),o=yield p.loadServerSession(n);console.log("keychain",n),console.log("session",o),e.emitter.on(y,([e])=>{if(e.geohash){let r=e.geohash;t.in(r).emit("message",e)}}),t.on("connection",(function(r){console.log("new connection"),r.on("join",n=>{h.PlaceController(t,r,n,e)})}))}))),t.default=m}).call(this,"/")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);n.__importDefault(r(21)),n.__importDefault(r(22)).default([{name:"env",alias:"e",defaultValue:"production",type:String}])},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("command-line-args")},function(e,t){e.exports=require("window")},function(e,t){e.exports=require("node-fetch")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6).Router();t.default=n},function(e,t){e.exports=require("radiks-server")},function(e,t){e.exports=require("http-status-codes")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),o=r(6),i=r(11);t.PlaceInfoController=e=>{const t=i.decorateApp(o.Router());return t.getAsync("/headcount/:geohash",(t,r)=>n.__awaiter(void 0,void 0,void 0,(function*(){const{geohash:o}=t.params;let i={_id:{$regex:o}},a=yield function(t){return n.__awaiter(this,void 0,void 0,(function*(){let r=e.collection("radiks-central-data").find(t),n=yield r.toArray();try{return n[0].group.attrs.members.length}catch(e){return 0}}))}(i);r.json({geohash:o,count:a})}))),t.getAsync("/nearest/populated/:lat/:long",(e,t)=>n.__awaiter(void 0,void 0,void 0,(function*(){const{lat:r,long:n}=e.params;t.json({error:"e"})}))),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),o=r(33),i=r(12);t.createKeyChain=function(){return n.__awaiter(this,void 0,void 0,(function*(){let e=process.env.SEED;return console.log("seed",e),yield o.initWalletFromSeed(e)}))},t.loadServerSession=function(e){return n.__awaiter(this,void 0,void 0,(function*(){let t=yield o.createBlockchainIdentity(e),r=o.makeUserSession(t.appPrivateKey,t.appPublicKey,t.username,t.profileJSON.decodedToken.payload.claim);yield o.configureRadiks(r);yield i.User.createWithCurrentUser();const n={backupPhrase:e.backupPhrase,publicKey:t.appPublicKey,privateKey:t.appPrivateKey,userSession:r,username:t.username,error:"none",profileJSON:t.profileJSON};return console.log("created radiksBatchAccount for the server! ",n),n}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),o=r(34),i=n.__importStar(r(1)),a=r(39),c=n.__importStar(r(0)),s=n.__importStar(r(5)),u=r(12),l=r(2);function d(e){return n.__awaiter(this,void 0,void 0,(function*(){let t=null;const r=yield i.mnemonicToSeed(e);return t=yield l.HDNode.fromSeedBuffer(r),{backupPhrase:e,masterKeychain:t,action:"none"}}))}function f(e,t,r,n=null,i=["store_write","publish_data"],a="goodtimesx.com",c="https://hub.blockstack.org"){const u=new s.AppConfig(i,a),l={username:r,decentralizedID:"did:btc-addr:"+t,appPrivateKey:e,authResponseToken:"",hubUrl:c,identityAddress:t,profile:n},d=new o.InstanceDataStore({appPrivateKey:e,hubUrl:c,userData:l});return new s.UserSession({appConfig:u,sessionStore:d})}function p(e,t,r){return a.signProfileForUpload(e,t,r)}function h(){return(Math.floor(1e5*Math.random())+1e5).toString().substring(1)}function g(e,t,r,n){let o=p(a.DEFAULT_PROFILE,{key:e,keyID:t},{gaiaHubConfig:{url_prefix:"https://gaia.blockstack.org/hub/"},gaiaHubUrl:"https://hub.blockstack.org"}),i=JSON.parse(o)[0];return i.decodedToken.payload.claim.image=[{"@type":"ImageObject",contentUrl:r,name:"avatar"}],i}r(8),t.initWallet=()=>n.__awaiter(void 0,void 0,void 0,(function*(){let e="none";let t,r=localStorage.getItem("backupPhrase");return r?t=r:(e="create",t=i.generateMnemonic(128,c.randomBytes),yield localStorage.setItem("backupPhrase",t)),yield d(t)})),t.initWalletFromSeed=d,t.makeUserSession=f,t.makeProfileJSON=p,t.saveProfileJSON=(e,t)=>n.__awaiter(void 0,void 0,void 0,(function*(){return yield e.putFile("profile.json",JSON.stringify(t),{encrypt:!1,contentType:"application/json"})})),t.configureRadiks=function(e){u.configure({apiServer:process.env.RADIKS_API_SERVER,userSession:e})},t.rando=h,t.createBlockchainIdentity=(e,r="good"+h()+".id.blockstack",o="https://gaia.blockstack.org/hub/17xxYBCvxwrwKtAna4bubsxGCMCcVNAgyw/avatar-0",i=2)=>n.__awaiter(void 0,void 0,void 0,(function*(){const{identityKeypairs:n}=a.getBlockchainIdentities(e.masterKeychain,i);let c=n[0].address,s=n[0].key,u=(n[0].keyID,g(s,c,o,r)),l=f(s,c,r,u.decodedToken.payload.claim),d=t.saveProfileJSON(l,[u]);return{appPublicKey:n[1].address,appPrivateKey:n[1].key,identityKeypairs:n,profileJSON:u,username:r,profileResp:d}})),t.getPublicKeyFromPrivate=function(e){return l.ECPair.fromPrivateKey(Buffer.from(e,"hex")).publicKey.toString("hex")},t.makeNewProfile=g},function(e,t){e.exports=require("blockstack/lib/auth/sessionStore")},function(e,t){e.exports=require("wolfy87-eventemitter")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);t.PlaceController=function(e,t,r,o){return n.__awaiter(this,void 0,void 0,(function*(){console.log("new joiner ",r),t.join(r,()=>n.__awaiter(this,void 0,void 0,(function*(){console.log(`New client connected to ${r}`),yield function(){return n.__awaiter(this,void 0,void 0,(function*(){let e=null,i=r;return new Promise((r,a)=>{let c=`place_${i}`;o.centralCollection.find({_id:{$regex:c}}).toArray((o,i)=>n.__awaiter(this,void 0,void 0,(function*(){i.length>0&&(e=i),t.emit("message",e),r(e)})))})}))}()})))}))}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function c(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))};const o=r(6),{decorateApp:i}=r(11),{COLLECTION:a}=r(13);e.exports=e=>{const t=i(o.Router()),r=e.collection(a);return t.getAsync("/messages",(e,t)=>n(void 0,void 0,void 0,(function*(){const n={$match:{radiksType:"Message"}};e.query.lt&&(n.$match.createdAt={$lt:parseInt(e.query.lt,10)}),e.query.createdBy&&(n.$match.createdBy=e.query.createdBy);const o=[n,{$sort:{createdAt:-1}},{$limit:10},{$lookup:{from:a,localField:"_id",foreignField:"messageId",as:"votes"}}],i=yield r.aggregate(o).toArray();let c=e.query.fetcher||e.universalCookies.get("username");c&&(c=c.replace(/"/g,"")),i.forEach(e=>{e.hasVoted=!1,c&&e.votes.forEach(t=>{t.username===c&&(e.hasVoted=!0)}),e.votes=e.votes.length}),t.json({messages:i})}))),t.getAsync("/avatar/:username",(e,t)=>n(void 0,void 0,void 0,(function*(){const{username:n}=e.params,o=yield r.findOne({_id:n});let i;return o.profile.image&&([i]=o.profile.image),i?t.redirect(i.contentUrl):t.redirect("/static/banana.jpg")}))),t}},function(e,t){e.exports=require("socket.io")},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"encrypt",(function(){return d}));var o={};r.r(o),r.d(o,"decrypt",(function(){return y}));var i=r(1),a=r.n(i);var c=r(0),s=r.n(c);const u=console;async function l(e,t){if(!a.a.validateMnemonic(e))throw new Error("Not a valid bip39 nmemonic");const r=Buffer.from(await async function(e){return a.a.mnemonicToEntropy(e).toString("hex")}(e),"hex"),n=s.a.randomBytes(16),o=s.a.pbkdf2Sync(t,n,1e5,48,"sha512"),i=o.slice(0,16),c=o.slice(16,32),u=o.slice(32,48),l=s.a.createCipheriv("aes-128-cbc",i,u);let d=l.update(r,"","hex");d+=l.final("hex");const f=Buffer.concat([n,Buffer.from(d,"hex")]),p=s.a.createHmac("sha256",c);p.write(f);const h=p.digest();return Buffer.concat([n,h,Buffer.from(d,"hex")])}async function d(e,t){return u.debug("Encrypting from worker",e,t),(await l(e,t)).toString("hex")}var f=r(14),p=r.n(f);const h=console;async function g(e,t){const r=e.slice(0,16),n=e.slice(16,48),o=e.slice(48),i=Buffer.concat([r,o]),c=s.a.pbkdf2Sync(t,r,1e5,48,"sha512"),u=c.slice(0,16),l=c.slice(16,32),d=c.slice(32,48),f=s.a.createDecipheriv("aes-128-cbc",u,d);let p=f.update(o,"","hex");p+=f.final("hex");const h=s.a.createHmac("sha256",l);h.write(i);const g=h.digest();if(s.a.createHash("sha256").update(n).digest().toString("hex")!==s.a.createHash("sha256").update(g).digest().toString("hex"))throw new Error("Wrong password (HMAC mismatch)");const y=await async function(e){return a.a.entropyToMnemonic(e)}(p);if(!a.a.validateMnemonic(y))throw new Error("Wrong password (invalid plaintext)");return y}async function y(e,t){h.debug("Decrypting from worker!");const r=Buffer.from(e,"hex");let n;try{n=await g(r,t)}catch(e){h.error("Could not decrypt.",e);try{h.debug("Trying to decrypt with legacy function."),n=await function(e,t){return new Promise((r,n)=>{p.a.decrypt({key:new Buffer(t),data:e},(e,t)=>{e?n(e):r(t)})})}(r,t)}catch(e){throw n=null,h.error("Could not decrypt again, most likely wrong password."),Error("Wrong Password.")}}return n.toString()}console;async function m(){return"true"===(await(void 0)().isCryptoInWorkerSupported()).toString()}async function v(e,t){const r=e.toString();let o;return o=await m()?(void 0)():n,o.encrypt(r,t)}async function b(e,t){const r=e.toString("hex");let n;n=await m()?(void 0)():o;const i=await n.decrypt(r,t);return Buffer.from(i)}var w=r(2);class k{constructor(e,t){this.hdNode=e,this.appDomain=t}getAppPrivateKey(){return this.hdNode.keyPair.d.toBuffer(32).toString("hex")}getAddress(){return this.hdNode.getAddress()}}class _{constructor(e,t){this.hdNode=e,this.salt=t}getNode(){return this.hdNode}getAppNode(e){const t=function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return 2147483647&t}(s.a.createHash("sha256").update(`${e}${this.salt}`).digest("hex")),r=this.hdNode.deriveHardened(t);return new k(r,e)}toBase58(){return this.hdNode.toBase58()}getSalt(){return this.salt}}class P{constructor(e,t){this.hdNode=e,this.salt=t}getNode(){return this.hdNode}getSalt(){return this.salt}getIdentityKey(){return this.hdNode.keyPair.d.toBuffer(32).toString("hex")}getIdentityKeyID(){return this.hdNode.keyPair.getPublicKeyBuffer().toString("hex")}getAppsNode(){return new _(this.hdNode.deriveHardened(0),this.salt)}getAddress(){return this.hdNode.getAddress()}getEncryptionNode(){return this.hdNode.deriveHardened(2)}getSigningNode(){return this.hdNode.deriveHardened(1)}}function x(e){let t=!1,r=null;return e.length>=8&&(t=!0,r="Password must be at least 8 characters"),{isValid:t,error:r}}function O(e){let t=!0,n=null;return Promise.resolve().then(r.t.bind(null,1,7)).then(r=>(r.validateMnemonic(e)||(t=!1,n="Backup phrase is not a valid set of words"),{isValid:t,error:n}))}function S(e,t){return new Promise((n,o)=>{b(new Buffer(t,"hex"),e).then(async e=>{const t=await Promise.resolve().then(r.t.bind(null,1,7)),o=e.toString(),i=t.mnemonicToSeed(o),a=w.HDNode.fromSeedBuffer(i);n(a)},e=>{o(new Error("Incorrect password"))})})}function A(e){return e.deriveHardened(44).deriveHardened(0).deriveHardened(0)}function E(e){return A(e).neutered()}function T(e,t=0,r="EXTERNAL_ADDRESS"){let n=null;if("EXTERNAL_ADDRESS"===r)n=0;else{if("CHANGE_ADDRESS"!==r)throw new Error("Invalid chain type");n=1}return e.derive(n).derive(t)}function N(e,t){return new Promise((r,n)=>S(e,t).then(e=>{const t=T(A(e),0).keyPair.d.toBuffer(32).toString("hex");r(t)}).catch(e=>{n(e)}))}function j(e){return e.deriveHardened(888).deriveHardened(0)}function C(e){return j(e).neutered()}function H(e,t=0){if(e.isNeutered())throw new Error("You need the private key to generate identity addresses");const r=e.keyPair.getPublicKeyBuffer().toString("hex"),n=s.a.createHash("sha256").update(r).digest("hex");return new P(e.deriveHardened(t),n)}function D(e){const t=e.getAddress(),r=e.getIdentityKey(),n=e.getIdentityKeyID(),o=e.getAppsNode();return{key:r,keyID:n,address:t,appsNodeKey:o.toBase58(),salt:o.getSalt()}}function I(e){return{twitter:{label:"Twitter",iconClass:"fa-twitter",social:!0,urlTemplate:"https://twitter.com/{identifier}"},facebook:{label:"Facebook",iconClass:"fa-facebook",social:!0,urlTemplate:"https://facebook.com/{identifier}"},github:{label:"GitHub",iconClass:"fa-github-alt",social:!0,urlTemplate:"https://github.com/{identifier}"},instagram:{label:"Instagram",iconClass:"fa-instagram",social:!0,urlTemplate:"https://instagram.com/{identifier}"},linkedIn:{label:"LinkedIn",iconClass:"fa-linkedin",social:!0,urlTemplate:"https://www.linkedin.com/in/{identifier}"},tumblr:{label:"Tumblr",iconClass:"fa-tumblr",social:!0,urlTemplate:"http://{identifier}.tumblr.com"},reddit:{label:"Reddit",iconClass:"fa-reddit-alien",social:!0,urlTemplate:"https://www.reddit.com/user/{identifier}"},pinterest:{label:"Pinterest",iconClass:"fa-pinterest",social:!0,urlTemplate:"https://pinterest.com/{identifier}"},youtube:{label:"YouTube",iconClass:"fa-youtube",social:!0,urlTemplate:"https://www.youtube.com/channel/{identifier}"},"google-plus":{label:"Google+",iconClass:"fa-google-plus",social:!0,urlTemplate:"https://plus.google.com/u/{identifier}"},angellist:{label:"AngelList",iconClass:"fa-angellist",social:!0,urlTemplate:"https://angel.co/{identifier}"},"stack-overflow":{label:"StackOverflow",iconClass:"fa-stack-overflow",social:!0,urlTemplate:"http://stackoverflow.com/users/{identifier}"},hackerNews:{label:"Hacker News",iconClass:"fa-hacker-news",social:!0,urlTemplate:"https://news.ycombinator.com/user?id={identifier}"},openbazaar:{label:"OpenBazaar",iconClass:"fa-shopping-cart",social:!0,urlTemplate:"ob://{identifier}"},snapchat:{label:"Snapchat",iconClass:"fa-snapchat-ghost",social:!0,urlTemplate:"https://snapchat.com/add/{identifier}"},website:{label:"Website",iconClass:"fa-link",social:!1,urlTemplate:"{identifier}"},ssh:{label:"SSH",iconClass:"fa-key",social:!1},pgp:{label:"PGP",iconClass:"fa-key",social:!1},bitcoin:{label:"Bitcoin",iconClass:"fa-bitcoin",social:!1,urlTemplate:e.bitcoinAddressUrl},ethereum:{label:"Ethereum",iconClass:"fa-key",social:!1,urlTemplate:e.ethereumAddressUrl}}}function B(e){if(!e||e.length<1)return 0;let t=0;return e.forEach(e=>{e.valid&&t<99&&t++}),t}function K(e,t){let r=0;return e.name&&e.name.length>0&&r++,r+=Math.min(B(t),1),r/2}function M(e,t){for(let r=0;r<t.length;r++)if(t[r]===e)return r;return null}function q(e,t){const r=j(e),n=A(e),o=r.neutered().toBase58(),i=n.neutered(),a=i.toBase58(),c=T(i).getAddress(),s=[],u=[];for(let e=0;e<t;e++){const t=D(H(r,e));u.push(t),s.push(t.address)}return{identityPublicKeychain:o,bitcoinPublicKeychain:a,firstBitcoinAddress:c,identityAddresses:s,identityKeypairs:u}}r(3);s.a.randomBytes(16).toString("hex");function R(e){window.open(e,"_blank").focus()}function U(){return window.innerWidth<=768}console;function F(e){return`bearer ${e}`}const $=console;function J(e){return 1e8*e}function L(e){return 1*e/1e8}function V(e,t){return new Promise((r,n)=>{const o={rawtx:t};fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(o)}).then(e=>e.text()).then(e=>JSON.parse(e)).then(e=>{r(e)}).catch(e=>{$.error("broadcastTransaction: error broadcasting transaction",e),n(e)})})}function W(e,t,r){console.log(`constant: blockstack_integration_test_api_password, parameter: ${r}`),"blockstack_integration_test_api_password"===r&&($.debug("getInsightUrls: using regtest mock insight api "),e="http://localhost:6270/insight-api/addr/{address}");const n=e.replace("{address}",t);return{base:n,confirmedBalanceUrl:`${n}/balance`,unconfirmedBalanceUrl:`${n}/unconfirmedBalance`}}function z(e){return new Promise((t,r)=>{fetch("https://bitcoinfees.21.co/api/v1/fees/recommended").then(e=>e.text()).then(e=>JSON.parse(e)).then(r=>{const n=r.fastestFee;t(e*n)}).catch(e=>{r(e)})})}function G(e){let t=0;return e&&e.twitter&&e.twitter.proof&&e.twitter.proof.url&&(t+=1),e&&e.facebook&&e.facebook.proof&&e.facebook.proof.url&&(t+=1),e&&e.github&&e.github.proof&&e.github.proof.url&&(t+=1),t}function Z(e,t){const r=G(e.profile),n=G(t.profile);return r<n?1:r>n?-1:0}const Y=console;function X(e){return/^[a-z0-9_-]+\.[a-z0-9_-]+$/.test(e)}function Q(e,t){let r=!1;return t.map(t=>(t.username===e&&(r=!0),null)),r}function ee(e,t){return console.log(t),new Promise((r,n)=>{const o=e.replace("{name}",t);fetch(o).then(e=>{e.ok?r(!1):404===e.status?r(!0):(Y.error("isNameAvailable",e),n("Error"))}).catch(e=>{Y.error("isNameAvailable",e),n(e)})})}function te(e){return 3===e.split(".").length}function re(e,t){return new Promise((r,n)=>{if(!X(t))return void n("Not a Blockstack name");const o=`${e.replace("{name}",t)}?single_sig=1`;fetch(o).then().then(e=>{e.ok?e.text().then(e=>JSON.parse(e)).then(e=>{r(e)}):(Y.error("getNamePrices: error parsing price result"),n("Error"))}).catch(e=>{Y.error("getNamePrices: error retrieving price",e),n(e)})})}var ne=r(5),oe=r(7),ie=r(9),ae=r.n(ie);console;const ce=ae.a.getCurveByName("secp256k1");function se(e,t){const r=Object(oe.decodeToken)(e),n=r.payload;if(!n.hasOwnProperty("subject"))throw new Error("Token doesn't have a subject");if(!n.subject.hasOwnProperty("publicKey"))throw new Error("Token doesn't have a subject public key");if(!n.hasOwnProperty("issuer"))throw new Error("Token doesn't have an issuer");if(!n.issuer.hasOwnProperty("publicKey"))throw new Error("Token doesn't have an issuer public key");if(!n.hasOwnProperty("claim"))throw new Error("Token doesn't have a claim");const o=n.issuer.publicKey,i=new Buffer(o,"hex"),a=ae.a.Point.decodeFrom(ce,i),c=new w.ECPair(null,a,{compressed:!0}).getAddress(),s=new w.ECPair(null,a,{compressed:!1}).getAddress();if(t===o);else if(t===c);else if(t!==s)throw new Error("Token issuer public key does not match the verifying value");const u=new oe.TokenVerifier(r.header.alg,o);if(!u)throw new Error("Invalid token verifier");if(!u.verify(e))throw new Error("Token verification failed");return r}function ue(e,t,r=!0){let n={};return e.map(e=>{let o=null;try{o=Object(oe.decodeToken)(e.token),o=function(e,t){if(null===t)throw new Error("A public key or keychain is required");if("string"!=typeof t)throw new Error("A valid address or public key is required");return se(e.token,t)}(e,t)}catch(e){if(!r)throw e;console.warn(e)}return null!==o&&(n=Object.assign({},n,o.payload.claim)),null}),n}function le(e,t,r){const n=t.key,o=t.keyID;e.api&&e.api.gaiaHubConfig&&(e.api.gaiaHubConfig={url_prefix:e.api.gaiaHubConfig.url_prefix}),r&&(e={...e,api:{gaiaHubConfig:{url_prefix:r.gaiaHubConfig.url_prefix},gaiaHubUrl:r.gaiaHubUrl}});const i=Object(ne.signProfileToken)(e,n,{publicKey:o}),a=[Object(ne.wrapProfileToken)(i)];return JSON.stringify(a,null,2)}const de={"@type":"Person","@context":"http://schema.org"};var fe=r(15);const pe=console;function he(e){if(!e.hasOwnProperty("uri"))return null;if(!Array.isArray(e.uri))return null;if(e.uri.length<1)return null;const t=e.uri[0];if(!t.hasOwnProperty("target"))return null;let r=t.target;return r.startsWith("https")||r.startsWith("http")||(r=`https://${r}`),r}function ge(e,t){return new Promise((r,n)=>{let o=null;try{o=Object(fe.parseZoneFile)(e),o.hasOwnProperty("$origin")||(o=null)}catch(e){n(e)}let i=null;if(o&&Object.keys(o).length>0){if(i=he(o),!i)return pe.warn("Token file url not found. Resolving to blank profile."),void r({});fetch(i).catch(e=>(pe.error("resolveZoneFileToProfile: error fetching token file without CORS proxy",e),proxyFetch(i))).then(e=>e.text()).then(e=>JSON.parse(e)).then(e=>{const n=ue(e,t);r(n)}).catch(e=>{pe.error(`resolveZoneFileToProfile: error fetching token file ${i}`,e),n(e)})}else{let t=null;try{t=JSON.parse(e),t=ne.Person.fromLegacyFormat(t).profile()}catch(e){n(e)}r(t)}})}r.d(t,"decryptMasterKeychain",(function(){return S})),r.d(t,"deriveIdentityKeyPair",(function(){return D})),r.d(t,"getBitcoinPrivateKeychain",(function(){return A})),r.d(t,"getBitcoinPublicKeychain",(function(){return E})),r.d(t,"getIdentityPrivateKeychain",(function(){return j})),r.d(t,"getIdentityPublicKeychain",(function(){return C})),r.d(t,"getWebAccountTypes",(function(){return I})),r.d(t,"isPasswordValid",(function(){return x})),r.d(t,"isBackupPhraseValid",(function(){return O})),r.d(t,"getIdentityOwnerAddressNode",(function(){return H})),r.d(t,"getBitcoinAddressNode",(function(){return T})),r.d(t,"findAddressIndex",(function(){return M})),r.d(t,"decryptBitcoinPrivateKey",(function(){return N})),r.d(t,"calculateTrustLevel",(function(){return B})),r.d(t,"calculateProfileCompleteness",(function(){return K})),r.d(t,"getBlockchainIdentities",(function(){return q})),r.d(t,"authorizationHeaderValue",(function(){return F})),r.d(t,"broadcastTransaction",(function(){return V})),r.d(t,"btcToSatoshis",(function(){return J})),r.d(t,"getNetworkFee",(function(){return z})),r.d(t,"getInsightUrls",(function(){return W})),r.d(t,"satoshisToBtc",(function(){return L})),r.d(t,"getNumberOfVerifications",(function(){return G})),r.d(t,"compareProfilesByVerifications",(function(){return Z})),r.d(t,"encrypt",(function(){return v})),r.d(t,"decrypt",(function(){return b})),r.d(t,"isABlockstackName",(function(){return X})),r.d(t,"hasNameBeenPreordered",(function(){return Q})),r.d(t,"isNameAvailable",(function(){return ee})),r.d(t,"isSubdomain",(function(){return te})),r.d(t,"getNamePrices",(function(){return re})),r.d(t,"getProfileFromTokens",(function(){return ue})),r.d(t,"signProfileForUpload",(function(){return le})),r.d(t,"verifyToken",(function(){return se})),r.d(t,"DEFAULT_PROFILE",(function(){return de})),r.d(t,"openInNewTab",(function(){return R})),r.d(t,"isMobile",(function(){return U})),r.d(t,"getTokenFileUrlFromZoneFile",(function(){return he})),r.d(t,"resolveZoneFileToProfile",(function(){return ge}))}]);